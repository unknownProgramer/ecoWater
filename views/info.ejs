<!DOCTYPE html>
<html lang="en">
<head>
    <%- include ('header.ejs') %>
</head>

<body class="g-sidenav-show  bg-gray-200">
<aside class="sidenav navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-3 bg-gradient-dark GOTHIC_M" id="sidenav-main">
    <div class="sidenav-header">
        <i class="fas fa-times p-3 cursor-pointer text-white opacity-5 position-absolute end-0 top-0 d-none d-xl-none" aria-hidden="true" id="iconSidenav"></i>
        <a class="navbar-brand m-0" href="/">
            <img src="img/observation-icon.png" class="navbar-brand-img h-100" alt="main_logo">
            <span class="ms-1 text-white">평림댐 관측 프로그램</span>
        </a>
    </div>
    <hr class="horizontal light mt-0 mb-2">
    <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link text-white" href="/">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">dashboard</i>
                    </div>
                    <span class="nav-link-text ms-1">메인</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white active bg-gradient-info" href="/info">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">info</i>
                    </div>
                    <span class="nav-link-text ms-1">평림댐 정보</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="/pred">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">opacity</i>
                    </div>
                    <span class="nav-link-text ms-1">평림댐 수위 / 수량예측</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="/noFunction">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">assignment</i>
                    </div>
                    <span class="nav-link-text ms-1">평림댐 수질정보 / 예측</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white" href="/noFunction">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">adjust</i>
                    </div>
                    <span class="nav-link-text ms-1">ECO-SYSTEM 관리</span>
                </a>
            </li>
            <hr class="horizontal light mt-5 mb-2">
            <li class="nav-item">
                <a class="nav-link text-white " href="/noFunction">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">login</i>
                    </div>
                    <span class="nav-link-text ms-1">로그인</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white " href="https://www.ecopeace.kr">
                    <div class="text-white text-center me-2 d-flex align-items-center justify-content-center">
                        <i class="material-icons opacity-10">backup_table</i>
                    </div>
                    <span class="nav-link-text ms-1">에코피스 홈페이지 이동</span>
                </a>
            </li>
        </ul>
    </div>
</aside>
<main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg ">

    <!-- 전체 container 시작-->
    <div class="container-fluid px-2 px-md-4">

        <!-- 타이틀 시작 -->
        <div class="page-header min-height-300 border-radius-xl mt-3" style="background-image: url('img/title.jpg');">
            <span class="mask GOTHIC_M"
                  style="color: #ffffff; font-size: 48px; font-weight: 500; margin-top: 120px; padding-left: 30px">수위예측 3D 디스플레이 시스템</span>
            <span class="mask GOTHIC_M" style="color: #000000; font-size: 28px; margin-top: 180px; padding-left: 30px">평림댐 정보</span>
        </div>
        <!-- 타이틀 끝 -->

        <!-- 전체 보드 시작 -->
        <div class="card card-body mx-3 mx-md-4 mt-n6 GOTHIC_M">

            <!-- 평림댐 정보 시작 -->
            <div class="row gx-4 mb-2 mx-auto">
                <div class="col-5 mx-5">
                    <div class="row mb-1" style="background-image: url('img/dam.jfif'); height: 300px; width: 500px">
                        <p>평림댐 전경</p>
                    </div>
                    <div class="row mt-1" id="kakao_map" style="height: 300px; width: 500px"></div>
                </div>
                <div class="col-5 mx-3" style="background-color: gray; width: 500px">
                    평림댐 정보 table
                </div>
            </div>
            <!-- 평림댐 정보 끝 -->

            <!-- 평림댐 데이터 시작 -->
            <div class="row gx-4 mb-2 mx-auto" style="height: 700px">
                <div class="col-10 mt-5">
                    <h3 class="GULIM">
                        평림댐 일일 데이터
                    </h3>
                    <p class="mb-0">일일자료는 용수관리(가뭄 등)에 활용할 수 있으며 최대 1년까지 조회 가능합니다.</p>
                    <p class="mb-0"><b style="color: #f34a44">모든 자료는 자정 기준으로 조회하며 파랑 등의 순간적인 수위변동에 따라 실제상황과 상이할 수 있습니다.</b></p>

                    <table style="text-align: center">
                        <thead style="background-color: antiquewhite">
                        <tr>
                            <td>
                                일자
                            </td>
                            <td>
                                수위 (EL.m)
                            </td>
                            <td>
                                저수량 (천 ㎥)
                            </td>
                            <td>
                                유입량 (㎥/s)
                            </td>
                            <td>
                                저수율 (%)
                            </td>
                        </tr>
                        </thead>
                        <tbody id="contents"></tbody>
                    </table>
                    <nav aria-label="Page navigation">
                        <ul class="pagination" id="pagination" style="justify-content: center; margin-top: 20px"></ul>
                    </nav>
                </div>
            </div>
            <!-- 평림댐 데이터 끝 -->
        </div>
        <!-- 평림댐 정보 끝 -->
        <!-- 전체 보드 끝 -->

    </div>

    <footer class="footer py-4  ">
        <div class="container-fluid">
            <div class="row align-items-center justify-content-lg-between">
                <div class="col-lg-6 mb-lg-0 mb-4">
                    <div class="copyright text-center text-sm text-muted text-lg-start">
                        Copyright ©
                        <script>
                            document.write(new Date().getFullYear())
                        </script>
                        ECOPEACE All Right Reserved.
                    </div>
                </div>
            </div>
        </div>
    </footer>

</main>

<!--   Core JS Files   -->
<script src="js/core/popper.min.js"></script>
<script src="js/core/bootstrap.min.js"></script>
<script src="js/plugins/perfect-scrollbar.min.js"></script>
<script src="js/plugins/smooth-scrollbar.min.js"></script>
<script src="js/plugins/chartjs.min.js"></script>

<!-- control script-->
<script>
    const win = navigator.platform.indexOf('Win') > -1;
    if (win && document.querySelector('#sidenav-scrollbar')) {
        const options = {
            damping: '0.5'
        }
        Scrollbar.init(document.querySelector('#sidenav-scrollbar'), options);
    }
</script>

<script>
    // 데이터 검색
    async function getList(value) {

        // 페이지네이션
        let total_page = Math.ceil( 365 / 10) ; // 모든 페이지의 수 (모든 데이터 = 365 / 한페이지에 나타낼 데이터 = 10)
        let page_group = Math.ceil( value / 10 ); // 화면에 보여질 페이지 그룹 (현재 보고 있는 페이지 = value / 한 화면에 나타낼 페이지 수 = 10)

        let last = page_group * 10; // 마지막 페이지네이션 번호 (페이지 그룹 * 한 화면에 나타낼 페이지 수 = 10), 단 계산된 값이 모든 페이지 수보다 많으면 마지막 페이지네이션 번호는 모든 페이지의 수.
        if (last > total_page) last = total_page;
        let first = last - ( 10 - 1 ) <= 0 ? 1 : last - (10 - 1) ; // 첫 페이지네이션 번호 (마지막 페이지네이션 번호 - (한 화면에 나타낼 페이지 - 1)), 단 계산된 값이 0보다 아래면 첫번째 페이지네이션 번호는 1.

        let next = last + 1; // 다음 그룹을 눌렀을 때 나타나야할 번호
        let prev = first - 1; // 이전 그룹을 눌렀을 때 나타나야할 번호

            await $.ajax({
                url : '/info/search',
                type : 'GET',
                data : {
                    index : value
                },
                dataType : "json",
                timeout : 10000,
                contentType : "application/json",
                success : function (data) {

                    // 데이터 그리기
                    const contents = $('#contents');
                    contents.empty();
                    for(let i = 0 ; i < 10; i ++){
                        contents.append('<tr>' +
                            '<td>' + (data.data[i][0]).slice(0,4) + '년' +  (data.data[i][0]).slice(4,-2) + '월' + (data.data[i][0]).slice(-2) + '일</td>' +
                            '<td>' + data.data[i][1] + '</td>' +
                            '<td>' + Math.ceil(data.data[i][2]) + '</td>' +
                            '<td>' + data.data[i][3] + '</td>' +
                            '<td>' + data.data[i][4] + '</td>' +
                            '</tr>');
                    }

                    // 페이지네이션 그리기
                    const pagination = $('#pagination');
                    pagination.empty();
                    if (value > 10) {
                        pagination.append('<li class="page-item">' +
                            '<a class="page-link" aria-label="Previous" id="prev">' +
                            '<span aria-hidden="true">&laquo;</span>' +
                            '</a>' +
                            '</li>');
                    }
                    for (let i = first; i <= last ; i ++ ){
                        if ( i == value){
                            pagination.append('<li class="page-item active"><a class="page-link" id="'+ i +'" onclick="getList('+ i +')">'+ i +'</a></li>');
                        } else {
                            pagination.append('<li class="page-item"><a class="page-link" id="'+ i +'" onclick="getList('+ i +')">'+ i +'</a></li>');
                        }
                    }
                    if (value < 31) {
                        pagination.append('<li class="page-item">' +
                            '<a class="page-link" aria-label="Next" id="next">' +
                            '<span aria-hidden="true">&raquo;</span>' +
                            '</a>' +
                            '</li>');
                    }

                    $('.page-link').click(function (e){
                        e.preventDefault();
                        let $item = $(this).attr('id');
                        if ($item == "next"){
                            getList(next);
                        } else if ($item == "prev"){
                            getList(prev);
                        }
                    })
                },
                error : function (error) {
                    console.log(error);
                }
            })
    }

    $(document).ready(function (){
        const value = 1;
        getList(value);
    })
</script>

<!-- kakaoMap JS(library)-->
<script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=97f87fc27d530467efbdb60ae6f1ea86&libraries=clusterer"></script>
<script>
    const mapContainer = document.getElementById('kakao_map'), // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(35.2892497, 126.6847616), // 지도의 중심좌표
            level: 4 // 지도의 확대 레벨
        };

    const map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

    // 일반 지도와 스카이뷰로 지도 타입을 전환할 수 있는 지도타입 컨트롤을 생성합니다
    const mapTypeControl = new kakao.maps.MapTypeControl();

    // 지도에 컨트롤을 추가해야 지도위에 표시됩니다
    // kakao.maps.ControlPosition은 컨트롤이 표시될 위치를 정의하는데 TOPRIGHT는 오른쪽 위를 의미합니다
    map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

    // 지도 확대 축소를 제어할 수 있는  줌 컨트롤을 생성합니다
    const zoomControl = new kakao.maps.ZoomControl();
    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

    // 마커가 표시될 위치입니다
    const markerPosition = new kakao.maps.LatLng(35.2892497, 126.6847616);

    // 마커를 생성합니다
    const marker = new kakao.maps.Marker({
        position: markerPosition
    });

    // 마커가 지도 위에 표시되도록 설정합니다
    marker.setMap(map);

    // 커스텀 오버레이에 표시할 컨텐츠 입니다
    // 커스텀 오버레이는 아래와 같이 사용자가 자유롭게 컨텐츠를 구성하고 이벤트를 제어할 수 있기 때문에
    // 별도의 이벤트 메소드를 제공하지 않습니다
    // const content = '<div class="kakao_wrap">' +
    //     '    <div class="kakao_info">' +
    //     '        <div class="kakao_title">' +
    //     '            에코피스 (주)' +
    //     '            <div class="kakao_close" onclick="closeOverlay()" title="닫기"></div>' +
    //     '        </div>' +
    //     '        <div class="kakao_body">' +
    //     '            <div class="kakao_img">' +
    //     '                <img src="../images/ecopeace-logo-small.png" width="76" height="71">' +
    //     '           </div>' +
    //     '            <div class="kakao_desc">' +
    //     '                <div class="kakao_ellipsis">광주광역시 북구 첨단벤처소로15번길 7, 1층</div>' +
    //     '                <div class="kakao_jibun ellipsis">062-431-3351 (지번) 북구 월출동 970-31</div>' +
    //     '                <div><a href="http://kko.to/jakMybsgF" target="_blank" class="kakao_link">자세히 보기</a></div>' +
    //     '            </div>' +
    //     '        </div>' +
    //     '    </div>' +
    //     '</div>';

    // 마커 위에 커스텀오버레이를 표시합니다
    // 마커를 중심으로 커스텀 오버레이를 표시하기위해 CSS를 이용해 위치를 설정했습니다
    const overlay = new kakao.maps.CustomOverlay({
        content: content,
        map: map,
        position: marker.getPosition()
    });

    // 마커를 클릭했을 때 커스텀 오버레이를 표시합니다
    kakao.maps.event.addListener(marker, 'click', function () {
        overlay.setMap(map);
    });

    // 커스텀 오버레이를 닫기 위해 호출되는 함수입니다
    function closeOverlay() {
        overlay.setMap(null);
    }
</script>

<!-- Github buttons -->
<script async defer src="https://buttons.github.io/buttons.js"></script>

<!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
<script src="js/material-dashboard.min.js?v=3.0.2"></script>
</body>
</html>